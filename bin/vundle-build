#!/usr/bin/env bash

# Build native components of bundles

sd() { [[ -d "$1" ]] && cd ~/.vim/bundle/"$1"; }

if sd youcompleteme; then
pkgs="build-essential cmake python-dev"
for p in $pkgs; do
  dpkg -s "$p" &>/dev/null || sudo apt-get -y install "$p"
done
./install.sh --gocode-completer # --clang-completer
fi

if sd vim-go; then
  if [[ -e "$GOPATH"/src/golang.org/x/tools/.git ]]; then
    git pull
  else
    git clone --depth 1 git://github.com/golang/tools.git "$GOPATH"/src/golang.org/x/tools
  fi

  # Manually install these binary as golang.org could be unreachable
  go install golang.org/x/tools/cmd/goimports
  go install golang.org/x/tools/cmd/oracle
  go install golang.org/x/tools/cmd/gorename

  [[ -n $TMUX ]] && vim='tmux new-window -d vim' || vim=gvim
  $vim -c 'execute "GoInstallBinaries"|qall!' &
fi

if sd go-explorer/src/getool; then
go install
fi
